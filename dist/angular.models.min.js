!function(a){"use strict";a.module("angular.models",["angular.models.core.extend","angular.models.core.sync","angular.models.core.model","angular.models.core.collection","angular.models.helper","angular.models.exception.validation"]),a.module("angular.models.core.collection",["angular.models.exception.validation","angular.models.core.extend","angular.models.helper","angular.models.core.sync","angular.models.core.events","angular.models.core.model"]).factory("BaseCollection",function(a,b,c,d,e,f,g,h,i){function j(a,b){b=b||{},b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))}var k={add:!0,remove:!0,merge:!0},l={add:!0,remove:!1};h.extend(j.prototype,c,{model:null,initialize:h.noop,toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){return this.set(a,h.extend({merge:!1},b,l))},remove:function(a,b){var c=!h.isArray(a);a=c?[a]:h.clone(a),b=b||{};for(var d=0,e=a.length;e>d;d++){var f=a[d]=this.get(a[d]);if(f){var g=this.modelId(f.attributes);null!=g&&delete this._byId[g],delete this._byId[f.cid];var i=this.indexOf(f);this.models.splice(i,1),this.length--,b.silent||(b.index=i,f.trigger("remove",f,this,b)),this._removeReference(f,b)}}return c?a[0]:a},set:function(a,b){b=h.defaults({},b,k),b.parse&&(a=this.parse(a,b));var c=!h.isArray(a);a=c?a?[a]:[]:a.slice();var d,e,f,g,j,l=b.at;0>l&&(l+=this.length+1);for(var m=this.comparator&&null==l&&b.sort!==!1,n=h.isString(this.comparator)?this.comparator:null,o=[],p=[],q={},r=b.add,s=b.merge,t=b.remove,u=!m&&r&&t?[]:!1,v=!1,w=0,x=a.length;x>w;w++){if(f=a[w],g=this.get(f))t&&(q[g.cid]=!0),s&&f!==g&&(f=i(f)?f.attributes:f,b.parse&&(f=g.parse(f,b)),g.set(f,b),m&&!j&&g.hasChanged(n)&&(j=!0)),a[w]=g;else if(r){if(e=a[w]=this._prepareModel(f,b),!e)continue;o.push(e),this._addReference(e,b)}e=g||e,e&&(d=this.modelId(e.attributes),!u||!e.isNew()&&q[d]||(u.push(e),v=v||!this.models[w]||e.cid!==this.models[w].cid),q[d]=!0)}if(t){for(var w=0,x=this.length;x>w;w++)q[(e=this.models[w]).cid]||p.push(e);p.length&&this.remove(p,b)}if(o.length||v)if(m&&(j=!0),this.length+=o.length,null!=l)for(var w=0,x=o.length;x>w;w++)this.models.splice(l+w,0,o[w]);else{u&&(this.models.length=0);for(var y=u||o,w=0,x=y.length;x>w;w++)this.models.push(y[w])}if(j&&this.sort({silent:!0}),!b.silent){for(var z=null!=l?h.clone(b):b,w=0,x=o.length;x>w;w++)null!=l&&(z.index=l+w),(e=o[w]).trigger("add",e,this,z);(j||v)&&this.trigger("sort",this,b)}return c?a[0]:a},reset:function(a,b){b=b?h.clone(b):{};for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c],b);return b.previousModels=this.models,this._reset(),a=this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},get:function(a){if(null==a)return void 0;var b=this.modelId(i(a)?a.attributes:a);return this._byId[a]||this._byId[b]||this._byId[a.cid]},getWithPromise:function(a){var b=Q.defer(),c=this.get(a);return c?b.resolve(c):b.reject(new Error("Model not found")),b.promise},at:function(a){return 0>a&&(a+=this.length),this.models[a]},where:function(a,b){var c=h.matches(a);return this[b?"find":"filter"](function(a){return c(a.attributes)})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return h.invoke(this.models,"get",a)},parse:function(a){return a},toArray:function(){return h.invoke(this.models,"toJSON")},fetch:function(b){var c=this;return a(function(a,d){b=h.extend({},b,{parse:!0}),b.success=function(d){c.set(d,b),c.trigger("fetched",c),a(c)},f(c,d,b),e("GET",c,b)})},create:function(b,c){var d=this;return c=c?h.clone(c):{},a(function(a,e){return(b=d._prepareModel(b,c))?void b.save(c).then(function(){d.add(b,c),b.trigger("created",b,d,c),a(b)},e):e()})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(i(a))return a.collection||(a.collection=this),a;b=b?h.clone(b):{},b.collection=this;var c=new this.model(a,b);return c.validationError?(this.trigger("invalid",this,c.validationError,b),!1):c},_addReference:function(a){this._byId[a.cid]=a;var b=this.modelId(a.attributes);null!=b&&(this._byId[b]=a),a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this){if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}this.trigger.apply(this,arguments)}}});var m=["each","map","find","filter","invoke","reject","every","all","some","any","contains","size","first","last","isEmpty","indexOf","indexBy"];return h.each(m,function(a){h[a]&&(j.prototype[a]=function(){var b=[].slice.call(arguments);return b.unshift(this.models),h[a].apply(h,b)})}),j.extend=d,j}),a.module("angular.models.core.model",["angular.models.exception.validation","angular.models.core.extend","angular.models.helper","angular.models.core.sync","angular.models.core.events"]).factory("BaseModel",function(a,b,c,d,e,f,g,h){function i(a,b){var c=a||{};b=b||{},this.cid=h.uniqueId("c"),this.attributes={},b.parse&&(c=this.parse(c,b)||{}),b.collection&&(this.collection=b.collection),c=h.defaults({},c,h.result(this,"defaults")),this.set(c,b),this.changed={},this.initialize.apply(this,arguments)}return h.extend(i.prototype,c,{changed:null,validationError:null,idAttribute:"id",initialize:h.noop,serializeModel:[],toJSON:function(){var a=this,b=h.cloneDeep(this.attributes);return h.isArray(this.serializeModel)&&this.serializeModel.length&&h.each(this.serializeModel,function(c){b[c]="toJSON"in a[c]?a[c].toJSON():null}),b},sync:function(){return e.apply(this,arguments)},get:function(a){var c=b(a);return c(this.attributes)},is:function(a){return!!this.attributes[a]},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,i,j,k,l,m;if(null==a)return this;"object"==typeof a?(e=a,c=b):(e={})[a]=b,c=c||{},c.validate=!0;var n=this._validate(e,c);if(n instanceof g)return!1;f=c.unset,j=c.silent,i=[],k=this._changing,this._changing=!0,k||(this._previousAttributes=h.clone(this.attributes),this.changed={}),m=this.attributes,l=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(m[d],b)||i.push(d),h.isEqual(l[d],b)?delete this.changed[d]:this.changed[d]=b,f===!0?delete m[d]:m[d]=b;if(!j){i.length&&(this._pending=c);for(var o=0,p=i.length;p>o;o++)this.trigger("change:"+i[o],this,m[i[o]],c)}if(k)return this;if(!j)for(;this._pending;)c=this._pending,this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url");if(null==a)throw new Error('A "url" property or function must be specified');return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},parse:function(a){return a},save:function(b){b=h.extend({validate:!0},b);var c=this,d=c.isNew()?"POST":"PUT";return a(function(a,e){return c.url()?c._validate({},b)?(b.success=function(b){return c.set(c.parse(b))?(c.trigger("sync",c),void a(c)):e(b)},f(c,e,b),void c.sync(d,c,b)):e(c.validationError):e()})},fetch:function(b){var c=this;return b=h.extend({},b),a(function(a,d){b.success=function(b){return c.set(c.parse(b))?(c.trigger("fetched",c,b),void a(c)):!1},f(c,d,b),c.sync("read",c,b)})},destroy:function(b){b=b||{};var c=this,d=function(){c.trigger("destroy",c,c.collection,b)};return a(function(a,e){return b.success=function(e){c.isNew()||c.trigger("sync",c,e,b),d(),a(c)},c.isNew()?b.success():(f(c,e,b),void c.sync("DELETE",c,b))})},remove:function(a){this.collection&&this.collection.remove(this,a)},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c instanceof g?(this.trigger("invalid",this,c,h.extend(b,{validationError:c})),!1):!0}}),i.extend=d,i}),a.module("angular.models.core.events",[]).service("Events",function(){var a={},b=/\s+/,c=function(a,c,d,e,f){var g,h=0;if(d&&"object"==typeof d){void 0!==e&&"context"in f&&void 0===f.context&&(f.context=e);for(g=_.keys(d);h<g.length;h++)c=a(c,g[h],d[g[h]],f)}else if(d&&b.test(d))for(g=d.split(b);h<g.length;h++)c=a(c,g[h],e,f);else c=a(c,d,e,f);return c};a.on=function(a,b,c){return d(this,a,b,c)};var d=function(a,b,d,f,g){if(a._events=c(e,a._events||{},b,d,{context:f,ctx:a,listening:g}),g){var h=a._listeners||(a._listeners={});h[g.id]=g}return a};a.listenTo=function(a,b,c){if(!a)return this;var e=a._listenId||(a._listenId=_.uniqueId("l")),f=this._listeningTo||(this._listeningTo={}),g=f[e];if(!g){var h=this._listenId||(this._listenId=_.uniqueId("l"));g=f[e]={obj:a,objId:e,id:h,listeningTo:f,count:0}}return d(a,b,c,this,g),this};var e=function(a,b,c,d){if(c){var e=a[b]||(a[b]=[]),f=d.context,g=d.ctx,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:f||g,listening:h})}return a};a.off=function(a,b,d){return this._events?(this._events=c(f,this._events,a,b,{context:d,listeners:this._listeners}),this):this},a.stopListening=function(a,b,c){var d=this._listeningTo;if(!d)return this;for(var e=a?[a._listenId]:_.keys(d),f=0;f<e.length;f++){var g=d[e[f]];if(!g)break;g.obj.off(b,c,this)}return _.isEmpty(d)&&(this._listeningTo=void 0),this};var f=function(a,b,c,d){if(a){var e,f=0,g=d.context,h=d.listeners;if(b||c||g){for(var i=b?[b]:_.keys(a);f<i.length;f++){b=i[f];var j=a[b];if(!j)break;for(var k=[],l=0;l<j.length;l++){var m=j[l];c&&c!==m.callback&&c!==m.callback._callback||g&&g!==m.context?k.push(m):(e=m.listening,e&&0===--e.count&&(delete h[e.id],delete e.listeningTo[e.objId]))}k.length?a[b]=k:delete a[b]}return _.size(a)?a:void 0}for(var n=_.keys(h);f<n.length;f++)e=h[n[f]],delete h[e.id],delete e.listeningTo[e.objId]}};a.once=function(a,b,d){var e=c(g,{},a,b,_.bind(this.off,this));return this.on(e,void 0,d)},a.listenToOnce=function(a,b,d){var e=c(g,{},b,d,_.bind(this.stopListening,this,a));return this.listenTo(a,e)};var g=function(a,b,c,d){if(c){var e=a[b]=_.once(function(){d(b,e),c.apply(this,arguments)});e._callback=c}return a};a.trigger=function(a){if(!this._events)return this;for(var b=Math.max(0,arguments.length-1),d=Array(b),e=0;b>e;e++)d[e]=arguments[e+1];return c(h,this._events,a,void 0,d),this};var h=function(a,b,c,d){if(a){var e=a[b],f=a.all;e&&f&&(f=f.slice()),e&&i(e,d),f&&i(f,[b].concat(d))}return a},i=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}};return a.bind=a.on,a.unbind=a.off,a}),a.module("angular.models.core.extend",[]).service("Extend",function(){return function(a,b){var c,d=this;c=a&&_.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},_.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&_.extend(c.prototype,a),c.__super__=d.prototype,c}}),a.module("angular.models.core.sync",["angular.models.helper"]).factory("Sync",function(a,b){function c(c,d,e){b.defaults(e||(e={}));var f={method:c,dataType:"json",cache:!1};if(f.headers={},f.headers.accept="application/json, text/plain, */*",f.url=e.url||b.result(d,"url"),!f.url)throw new Error('A "url" property or function must be specified');return null==e.data&&d&&b.include(["POST","PUT","PATCH"],c)&&(f.headers["content-type"]="application/json",f.data=JSON.stringify(e.attrs||d.toJSON(e))),a(f).success(e.success).error(e.error)}return c}),a.module("angular.models.exception.validation",[]).factory("ValidationException",function(){function a(a){this.name="ValidationError",this.message=a}return a.prototype=new Error,a.constructor=a,a}),a.module("angular.models.helper",["angular.models.core.model"]).factory("_",["$window",function(a){return a._}]).factory("isModel",function(a){return function(b){return b instanceof a}}).factory("WrapError",function(a){function b(b,c,d){d.error=function(){var d=[].concat([b],a.toArray(arguments));b&&b.trigger.apply(b,[].concat(["error"],d));var e=a.zipObject(["model","xhr","textStatus","error"],d);c&&c(e)}}return b})}(angular);
//# sourceMappingURL=angular.models.map