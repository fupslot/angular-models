!function(a){"use strict";a.module("angular.models",["angular.models.core.extend","angular.models.core.sync","angular.models.core.model","angular.models.core.collection","angular.models.helper","angular.models.exception.validation"]),a.module("angular.models.core.collection",["angular.models.exception.validation","angular.models.helper","angular.models.core.sync","angular.models.core.extend","angular.models.core.model"]).factory("BaseCollectionClass",function(a,b,c,d,e,f,g,h){function i(a,b){b=b||{},b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,g.extend({silent:!0},b))}var j,k={add:!0,remove:!0,merge:!0},l={add:!0,remove:!1};j=i.prototype=Object.create(d.prototype),Object.defineProperty(j,"model",{value:null,writable:!0}),Object.defineProperty(j,"initialize",{value:g.noop}),Object.defineProperty(j,"toJSON",{value:function(a){return this.map(function(b){return b.toJSON(a)})}}),Object.defineProperty(j,"add",{value:function(a,b){return this.set(a,g.extend({merge:!1},b,l))}}),Object.defineProperty(j,"remove",{value:function(a,b){var c=!g.isArray(a);a=c?[a]:g.clone(a),b=b||{};for(var d=0,e=a.length;e>d;d++){var f=a[d]=this.get(a[d]);if(f){var h=this.modelId(f.attributes);null!=h&&delete this._byId[h],delete this._byId[f.cid];var i=this.indexOf(f);this.models.splice(i,1),this.length--,b.silent||(b.index=i,f.trigger("remove",f,this,b)),this._removeReference(f,b)}}return c?a[0]:a}}),Object.defineProperty(j,"set",{value:function(a,b){b=g.defaults({},b,k),b.parse&&(a=this.parse(a,b));var c=!g.isArray(a);a=c?a?[a]:[]:a.slice();var d,e,f,i,j,l=b.at;0>l&&(l+=this.length+1);var m,n,o=this.comparator&&null==l&&b.sort!==!1,p=g.isString(this.comparator)?this.comparator:null,q=[],r=[],s={},t=b.add,u=b.merge,v=b.remove,w=!o&&t&&v?[]:!1,x=!1;for(m=0,n=a.length;n>m;m++){if(f=a[m],i=this.get(f))v&&(s[i.cid]=!0),u&&f!==i&&(f=h(f)?f.attributes:f,b.parse&&(f=i.parse(f,b)),i.set(f,b),o&&!j&&i.hasChanged(p)&&(j=!0)),a[m]=i;else if(t){if(e=a[m]=this._prepareModel(f,b),!e)continue;q.push(e),this._addReference(e,b)}e=i||e,e&&(d=this.modelId(e.attributes),!w||!e.isNew()&&s[d]||(w.push(e),x=x||!this.models[m]||e.cid!==this.models[m].cid),s[d]=!0)}if(v){for(m=0,n=this.length;n>m;m++)s[(e=this.models[m]).cid]||r.push(e);r.length&&this.remove(r,b)}if(q.length||x)if(o&&(j=!0),this.length+=q.length,null!=l)for(m=0,n=q.length;n>m;m++)this.models.splice(l+m,0,q[m]);else{w&&(this.models.length=0);var y=w||q;for(m=0,n=y.length;n>m;m++)this.models.push(y[m])}if(j&&this.sort({silent:!0}),!b.silent){var z=null!=l?g.clone(b):b;for(m=0,n=q.length;n>m;m++)null!=l&&(z.index=l+m),(e=q[m]).trigger("add",e,this,z);(j||x)&&this.trigger("sort",this,b)}return c?a[0]:a}}),Object.defineProperty(j,"reset",{value:function(a,b){b=b?g.clone(b):{};for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c],b);return b.previousModels=this.models,this._reset(),a=this.add(a,g.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a}}),Object.defineProperty(j,"get",{value:function(a){if(null==a)return void 0;var b=this.modelId(h(a)?a.attributes:a);return this._byId[a]||this._byId[b]||this._byId[a.cid]}}),Object.defineProperty(j,"at",{value:function(a){return 0>a&&(a+=this.length),this.models[a]}}),Object.defineProperty(j,"where",{value:function(a,b){var c=g.matches(a);return this[b?"find":"filter"](function(a){return c(a.attributes)})}}),Object.defineProperty(j,"findWhere",{value:function(a){return this.where(a,!0)}}),Object.defineProperty(j,"sort",{value:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),g.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(g.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this}}),Object.defineProperty(j,"pluck",{value:function(a){return g.invoke(this.models,"get",a)}}),Object.defineProperty(j,"parse",{value:function(a){return a}}),Object.defineProperty(j,"toArray",{value:function(){return g.invoke(this.models,"toJSON")}}),Object.defineProperty(j,"fetch",{value:function(b){var c=this;return a(function(a,d){b=g.extend({},b,{parse:!0}),b.success=function(d){c.set(d,b),c.trigger("fetched",c),a(c)},e(c,d,b),c.sync("GET",c,b)})}}),Object.defineProperty(j,"create",{value:function(b,c){var d=this;return c=c?g.clone(c):{},a(function(a,e){return(b=d._prepareModel(b,c))?void b.save(c).then(function(){d.add(b,c),b.trigger("created",b,d,c),a(b)},e):e()})}}),Object.defineProperty(j,"modelId",{value:function(a){return a[this.model.prototype.idAttribute||"id"]}}),Object.defineProperty(j,"_reset",{value:function(){this.length=0,this.models=[],this._byId={}}}),Object.defineProperty(j,"_prepareModel",{value:function(a,b){if(h(a))return a.collection||(a.collection=this),a;b=b?g.clone(b):{},b.collection=this;var c=new this.model(a,b);return c.validationError?(this.trigger("invalid",this,c.validationError,b),!1):c}}),Object.defineProperty(j,"_addReference",{value:function(a){this._byId[a.cid]=a;var b=this.modelId(a.attributes);null!=b&&(this._byId[b]=a),a.on("all",this._onModelEvent,this)}}),Object.defineProperty(j,"_removeReference",{value:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)}}),Object.defineProperty(j,"_onModelEvent",{value:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this){if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}this.trigger.apply(this,arguments)}}});var m=["each","map","find","filter","invoke","reject","every","all","some","any","contains","size","first","last","isEmpty","indexOf","indexBy"];return g.each(m,function(a){g[a]&&Object.defineProperty(j,a,{value:function(){var b=[].slice.call(arguments);return b.unshift(this.models),g[a].apply(g,b)}})}),i.extend=c,i}),a.module("angular.models.core.model",["angular.models.exception.validation","angular.models.helper","angular.models.core.sync","angular.models.core.extend"]).factory("BaseModelClass",function(a,b,c,d,e,f,g){function h(a,b){var c=a||{};b=b||{},this.cid=g.uniqueId("c"),this.attributes={},b.parse&&(c=this.parse(c,b)||{}),b.collection&&(this.collection=b.collection),c=g.defaults({},c,g.result(this,"defaults")),this.set(c,b),this.changed={},this.initialize.apply(this,arguments)}var i;return i=h.prototype=Object.create(d.prototype),Object.defineProperty(i,"changed",{value:null,writable:!0}),Object.defineProperty(i,"validationError",{value:null,writable:!0}),Object.defineProperty(i,"idAttribute",{value:"id",writable:!0}),Object.defineProperty(i,"initialize",{value:g.noop,writable:!0}),Object.defineProperty(i,"serializeModel",{value:[],writable:!0}),Object.defineProperty(i,"toJSON",{value:function(){var a=this,b=g.cloneDeep(this.attributes);return g.isArray(this.serializeModel)&&this.serializeModel.length&&g.each(this.serializeModel,function(c){b[c]="toJSON"in a[c]?a[c].toJSON():null}),b}}),Object.defineProperty(i,"get",{value:function(a){var c=b(a);return c(this.attributes)}}),Object.defineProperty(i,"is",{value:function(a){return!!this.attributes[a]}}),Object.defineProperty(i,"has",{value:function(a){return null!=this.get(a)}}),Object.defineProperty(i,"set",{value:function(a,b,c){var d,e,h,i,j,k,l,m;if(null==a)return this;"object"==typeof a?(e=a,c=b):(e={})[a]=b,c=c||{},c.validate=!0;var n=this._validate(e,c);if(n instanceof f)return!1;h=c.unset,j=c.silent,i=[],k=this._changing,this._changing=!0,k||(this._previousAttributes=g.clone(this.attributes),this.changed={}),m=this.attributes,l=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],g.isEqual(m[d],b)||i.push(d),g.isEqual(l[d],b)?delete this.changed[d]:this.changed[d]=b,h===!0?delete m[d]:m[d]=b;if(!j){i.length&&(this._pending=c);for(var o=0,p=i.length;p>o;o++)this.trigger("change:"+i[o],this,m[i[o]],c)}if(k)return this;if(!j)for(;this._pending;)c=this._pending,this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this}}),Object.defineProperty(i,"unset",{value:function(a,b){return this.set(a,void 0,g.extend({},b,{unset:!0}))}}),Object.defineProperty(i,"clear",{value:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,g.extend({},a,{unset:!0}))}}),Object.defineProperty(i,"hasChanged",{value:function(a){return null==a?!g.isEmpty(this.changed):g.has(this.changed,a)}}),Object.defineProperty(i,"changedAttributes",{value:function(a){if(!a)return this.hasChanged()?g.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)g.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c}}),Object.defineProperty(i,"previous",{value:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null}}),Object.defineProperty(i,"previousAttributes",{value:function(){return g.clone(this._previousAttributes)}}),Object.defineProperty(i,"url",{value:function(){var a=g.result(this,"urlRoot")||g.result(this.collection,"url");if(null==a)throw new Error('A "url" property or function must be specified');return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)}}),Object.defineProperty(i,"clone",{value:function(){return new this.constructor(this.attributes)}}),Object.defineProperty(i,"isNew",{value:function(){return!this.has(this.idAttribute)}}),Object.defineProperty(i,"isValid",{value:function(a){return this._validate({},g.extend(a||{},{validate:!0}))}}),Object.defineProperty(i,"parse",{value:function(a){return a}}),Object.defineProperty(i,"save",{value:function(b){b=g.extend({validate:!0},b);var c=this,d=c.isNew()?"POST":"PUT";return a(function(a,f){return c.url()?c._validate({},b)?(b.success=function(b){return c.set(c.parse(b))?(c.trigger("sync",c),void a(c)):f(b)},e(c,f,b),void c.sync(d,c,b)):f(c.validationError):f()})}}),Object.defineProperty(i,"fetch",{value:function(b){var c=this;return b=g.extend({},b),a(function(a,d){b.success=function(b){return c.set(c.parse(b))?(c.trigger("fetched",c,b),void a(c)):d(b)},e(c,d,b),c.sync("GET",c,b)})}}),Object.defineProperty(i,"destroy",{value:function j(b){b=b||{};var c=this,j=function(){c.trigger("destroy",c,c.collection,b)};return a(function(a,d){return b.success=function(d){c.isNew()||c.trigger("sync",c,d,b),j(),a(c)},c.isNew()?b.success():(e(c,d,b),void c.sync("DELETE",c,b))})}}),Object.defineProperty(i,"remove",{value:function(a){this.collection&&this.collection.remove(this,a)}}),Object.defineProperty(i,"_validate",{value:function(a,b){if(!b.validate||!this.validate)return!0;a=g.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c instanceof f?(this.trigger("invalid",this,c,g.extend(b,{validationError:c})),!1):!0}}),h.extend=c,h}),a.module("angular.models.core.events",[]).service("Events",function(a){var b=function(){},c=/\s+/,d=function(a,b,c,d){if(c){var e=a[b]||(a[b]=[]),f=d.context,g=d.ctx,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:f||g,listening:h})}return a},e=function(b,d,e,f,g){var h,i=0;if(e&&"object"==typeof e){void 0!==f&&"context"in g&&void 0===g.context&&(g.context=f);for(h=a.keys(e);i<h.length;i++)d=b(d,h[i],e[h[i]],g)}else if(e&&c.test(e))for(h=e.split(c);i<h.length;i++)d=b(d,h[i],f,g);else d=b(d,e,f,g);return d},f=function(a,b,c,f,g){if(a._events=e(d,a._events||{},b,c,{context:f,ctx:a,listening:g}),g){var h=a._listeners||(a._listeners={});h[g.id]=g}return a},g=function(b,c,d,e){if(!b)return null;var f,g=0,h=e.context,i=e.listeners;if(!c&&!d&&!h){for(var j=a.keys(i);g<j.length;g++)f=i[j[g]],delete i[f.id],delete f.listeningTo[f.objId];return null}for(var k=c?[c]:a.keys(b);g<k.length;g++){c=k[g];var l=b[c];if(!l)break;for(var m=[],n=0;n<l.length;n++){var o=l[n];d&&d!==o.callback&&d!==o.callback._callback||h&&h!==o.context?m.push(o):(f=o.listening,f&&0===--f.count&&(delete i[f.id],delete f.listeningTo[f.objId]))}m.length?b[c]=m:delete b[c]}return a.size(b)?b:void 0},h=function(b,c,d,e){if(d){var f=b[c]=a.once(function(){e(c,f),d.apply(this,arguments)});f._callback=d}return b},i=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},j=function(a,b,c,d){if(a){var e=a[b],f=a.all;e&&f&&(f=f.slice()),e&&i(e,d),f&&i(f,[b].concat(d))}return a};return b.prototype.on=function(a,b,c){return f(this,a,b,c)},b.prototype.listenTo=function(b,c,d){if(!b)return this;var e=b._listenId||(b._listenId=a.uniqueId("l")),g=this._listeningTo||(this._listeningTo={}),h=g[e];if(!h){var i=this._listenId||(this._listenId=a.uniqueId("l"));h=g[e]={obj:b,objId:e,id:i,listeningTo:g,count:0}}return f(b,c,d,this,h),this},b.prototype.off=function(a,b,c){return this._events?(this._events=e(g,this._events,a,b,{context:c,listeners:this._listeners}),this):this},b.prototype.stopListening=function(b,c,d){var e=this._listeningTo;if(!e)return this;for(var f=b?[b._listenId]:a.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(c,d,this)}return a.isEmpty(e)&&(this._listeningTo=void 0),this},b.prototype.once=function(b,c,d){var f=e(h,{},b,c,a.bind(this.off,this));return this.on(f,void 0,d)},b.prototype.listenToOnce=function(b,c,d){var f=e(h,{},c,d,a.bind(this.stopListening,this,b));return this.listenTo(b,f)},b.prototype.trigger=function(a){if(!this._events)return this;for(var b=Math.max(0,arguments.length-1),c=Array(b),d=0;b>d;d++)c[d]=arguments[d+1];return e(j,this._events,a,void 0,c),this},b.prototype.bind=b.prototype.on,b.prototype.unbind=b.prototype.off,b}),a.module("angular.models.core.extend",[]).factory("Extend",function(){function a(a){var b,c=this;return b=a&&a.hasOwnProperty("constructor")?a.constructor.value:function(){return c.apply(this,arguments)},b.prototype=Object.create(c.prototype,a),b.__super__=c.prototype,b}return a}),a.module("angular.models.core.sync",["angular.models.helper","angular.models.core.events"]).factory("Sync",function(b,c,d){function e(){}var f;return f=e.prototype=Object.create(d.prototype),Object.defineProperty(f,"sync",{value:function(d,e,f){c.defaults(f||(f={}));var g=c.extend({method:d,dataType:"json",cache:!1},c.pick(f,"params"));if(g.headers={},g.headers.accept="application/json, text/plain, */*",g.url=f.url||c.result(e,"url"),!g.url)throw new Error('A "url" property or function must be specified');return null==f.data&&e&&c.include(["POST","PUT","PATCH"],d)&&(g.headers["content-type"]="application/json",g.data=JSON.stringify(f.attrs||e.toJSON(f))),f.success=f.success||a.noop,f.error=f.error||a.noop,b(g).success(f.success).error(f.error)}}),e}),a.module("angular.models.exception.validation",[]).factory("ValidationException",function(){function a(a){this.name="ValidationError",this.message=a}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}),a.module("angular.models.helper",["angular.models.core.model"]).factory("_",["$window",function(a){return a._}]).factory("isModel",function(a){return function(b){return b instanceof a}}).factory("WrapError",function(a){function b(b,c,d){d.error=function(){var d=[].concat([b],a.toArray(arguments));b&&b.trigger.apply(b,[].concat(["error"],d));var e=a.zipObject(["model","xhr","textStatus","error"],d);c&&c(e)}}return b})}(angular);
//# sourceMappingURL=angular.models.map