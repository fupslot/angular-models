!function(a){!function(a,b,c){"use strict";b.module("angular.models",[]),b.module("angular.models").factory("BaseClass",["Extend",function(a){function b(){}return b.extend=a,b}]),b.module("angular.models").factory("BaseCollectionClass",["$q","$parse","Extend","BaseSyncClass","WrapError","_","isModel",function(a,b,c,d,e,f,g){function h(a,b){b=b||{},b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,f.extend({silent:!0},b))}var i,j={add:!0,remove:!0,merge:!0},k={add:!0,remove:!1};i=h.prototype=Object.create(d.prototype),Object.defineProperty(i,"model",{value:null,writable:!0}),Object.defineProperty(i,"initialize",{value:f.noop}),Object.defineProperty(i,"toJSON",{value:function(a){return this.map(function(b){return b.toJSON(a)})}}),Object.defineProperty(i,"add",{value:function(a,b){return this.set(a,f.extend({merge:!1},b,k))}}),Object.defineProperty(i,"remove",{value:function(a,b){var c=!f.isArray(a);a=c?[a]:f.clone(a),b=b||{};for(var d=0,e=a.length;e>d;d++){var g=a[d]=this.get(a[d]);if(g){var h=this.modelId(g.attributes);null!=h&&delete this._byId[h],delete this._byId[g.cid];var i=this.indexOf(g);this.models.splice(i,1),this.length--,b.silent||(b.index=i,g.trigger("remove",g,this,b)),this._removeReference(g,b)}}return c?a[0]:a}}),Object.defineProperty(i,"set",{value:function(a,b){b=f.defaults({},b,j),b.parse&&(a=this.parse(a,b));var c=!f.isArray(a);a=c?a?[a]:[]:a.slice();var d,e,h,i,k,l=b.at;0>l&&(l+=this.length+1);var m,n,o=this.comparator&&null==l&&b.sort!==!1,p=f.isString(this.comparator)?this.comparator:null,q=[],r=[],s={},t=b.add,u=b.merge,v=b.remove,w=!o&&t&&v?[]:!1,x=!1;for(m=0,n=a.length;n>m;m++){if(h=a[m],i=this.get(h))v&&(s[i.cid]=!0),u&&h!==i&&(h=g(h)?h.attributes:h,b.parse&&(h=i.parse(h,b)),i.set(h,b),o&&!k&&i.hasChanged(p)&&(k=!0)),a[m]=i;else if(t){if(e=a[m]=this._prepareModel(h,b),!e)continue;q.push(e),this._addReference(e,b)}e=i||e,e&&(d=this.modelId(e.attributes),!w||!e.isNew()&&s[d]||(w.push(e),x=x||!this.models[m]||e.cid!==this.models[m].cid),s[d]=!0)}if(v){for(m=0,n=this.length;n>m;m++)s[(e=this.models[m]).cid]||r.push(e);r.length&&this.remove(r,b)}if(q.length||x)if(o&&(k=!0),this.length+=q.length,null!=l)for(m=0,n=q.length;n>m;m++)this.models.splice(l+m,0,q[m]);else{w&&(this.models.length=0);var y=w||q;for(m=0,n=y.length;n>m;m++)this.models.push(y[m])}if(k&&this.sort({silent:!0}),!b.silent){var z=null!=l?f.clone(b):b;for(m=0,n=q.length;n>m;m++)null!=l&&(z.index=l+m),(e=q[m]).trigger("add",e,this,z);(k||x)&&this.trigger("sort",this,b)}return c?a[0]:a}}),Object.defineProperty(i,"reset",{value:function(a,b){b=b?f.clone(b):{};for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c],b);return b.previousModels=this.models,this._reset(),a=this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a}}),Object.defineProperty(i,"get",{value:function(a){if(null==a)return void 0;var b=this.modelId(g(a)?a.attributes:a);return this._byId[a]||this._byId[b]||this._byId[a.cid]}}),Object.defineProperty(i,"at",{value:function(a){return 0>a&&(a+=this.length),this.models[a]}}),Object.defineProperty(i,"where",{value:function(a,b){var c=f.matches(a);return this[b?"find":"filter"](function(a){return c(a.attributes)})}}),Object.defineProperty(i,"findWhere",{value:function(a){return this.where(a,!0)}}),Object.defineProperty(i,"sort",{value:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),f.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this}}),Object.defineProperty(i,"pluck",{value:function(a){return f.invoke(this.models,"get",a)}}),Object.defineProperty(i,"parse",{value:function(a){return a}}),Object.defineProperty(i,"toArray",{value:function(){return f.invoke(this.models,"toJSON")}}),Object.defineProperty(i,"fetch",{value:function(b){var c=this;return a(function(a,d){b=f.extend({},b,{parse:!0}),b.success=function(d){c.set(d,b),c.trigger("fetched",c),a(c)},e(c,d,b),c.sync("read",c,b)})}}),Object.defineProperty(i,"create",{value:function(b,c){var d=this;return c=c?f.clone(c):{},a(function(a,e){return(b=d._prepareModel(b,c))?void b.save(c).then(function(){d.add(b,c),b.trigger("created",b,d,c),a(b)},e):e()})}}),Object.defineProperty(i,"modelId",{value:function(a){return a[this.model.prototype.idAttribute||"id"]}}),Object.defineProperty(i,"_reset",{value:function(){this.length=0,this.models=[],this._byId={}}}),Object.defineProperty(i,"_prepareModel",{value:function(a,b){if(g(a))return a.collection||(a.collection=this),a;b=b?f.clone(b):{},b.collection=this;var c=new this.model(a,b);return c.validationError?(this.trigger("invalid",this,c.validationError,b),!1):c}}),Object.defineProperty(i,"_addReference",{value:function(a){this._byId[a.cid]=a;var b=this.modelId(a.attributes);null!=b&&(this._byId[b]=a),a.on("all",this._onModelEvent,this)}}),Object.defineProperty(i,"_removeReference",{value:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)}}),Object.defineProperty(i,"_onModelEvent",{value:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this){if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}this.trigger.apply(this,arguments)}}});var l=["each","map","find","filter","invoke","reject","every","all","some","any","contains","size","first","last","isEmpty","indexOf","indexBy"];return f.each(l,function(a){f[a]&&Object.defineProperty(i,a,{value:function(){var b=[].slice.call(arguments);return b.unshift(this.models),f[a].apply(f,b)}})}),h.extend=c,h}]),b.module("angular.models").factory("BaseModelClass",["$q","$parse","Extend","BaseSyncClass","WrapError","ValidationExceptionClass","_",function(a,b,c,d,e,f,g){function h(a,b){var c=a||{};b=b||{},this.cid=g.uniqueId("c"),this.attributes={},b.parse&&(c=this.parse(c,b)||{}),b.collection&&(this.collection=b.collection),c=g.defaults({},c,g.result(this,"defaults")),this.set(c,b),this.changed={},this.initialize.apply(this,arguments)}var i;return i=h.prototype=Object.create(d.prototype),Object.defineProperty(i,"defaultQueryParams",{value:{}}),Object.defineProperty(i,"changed",{value:null,writable:!0}),Object.defineProperty(i,"validationError",{value:null,writable:!0}),Object.defineProperty(i,"idAttribute",{value:"id",writable:!0}),Object.defineProperty(i,"initialize",{value:g.noop,writable:!0}),Object.defineProperty(i,"serializeModel",{value:[],writable:!0}),Object.defineProperty(i,"toJSON",{value:function(){var a=this,b=g.cloneDeep(this.attributes);return g.isArray(this.serializeModel)&&this.serializeModel.length&&g.each(this.serializeModel,function(c){b[c]="toJSON"in a[c]?a[c].toJSON():null}),b}}),Object.defineProperty(i,"get",{value:function(a){var c=b(a);return c(this.attributes)}}),Object.defineProperty(i,"is",{value:function(a){return!!this.attributes[a]}}),Object.defineProperty(i,"has",{value:function(a){return null!=this.get(a)}}),Object.defineProperty(i,"set",{value:function(a,b,c){var d,e,h,i,j,k,l,m;if(null==a)return this;"object"==typeof a?(e=a,c=b):(e={})[a]=b,c=c||{},c.validate=!0;var n=this._validate(e,c);if(n instanceof f)return!1;h=c.unset,j=c.silent,i=[],k=this._changing,this._changing=!0,k||(this._previousAttributes=g.clone(this.attributes),this.changed={}),m=this.attributes,l=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],g.isEqual(m[d],b)||i.push(d),g.isEqual(l[d],b)?delete this.changed[d]:this.changed[d]=b,h===!0?delete m[d]:m[d]=b;if(!j){i.length&&(this._pending=c);for(var o=0,p=i.length;p>o;o++)this.trigger("change:"+i[o],this,m[i[o]],c)}if(k)return this;if(!j)for(;this._pending;)c=this._pending,this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this}}),Object.defineProperty(i,"unset",{value:function(a,b){return this.set(a,void 0,g.extend({},b,{unset:!0}))}}),Object.defineProperty(i,"clear",{value:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,g.extend({},a,{unset:!0}))}}),Object.defineProperty(i,"hasChanged",{value:function(a){return null==a?!g.isEmpty(this.changed):g.has(this.changed,a)}}),Object.defineProperty(i,"changedAttributes",{value:function(a){if(!a)return this.hasChanged()?g.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)g.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c}}),Object.defineProperty(i,"previous",{value:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null}}),Object.defineProperty(i,"previousAttributes",{value:function(){return g.clone(this._previousAttributes)}}),Object.defineProperty(i,"url",{value:function(){var a=g.result(this,"urlRoot")||g.result(this.collection,"url");if(null==a)throw new Error('A "url" property or function must be specified');return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)}}),Object.defineProperty(i,"clone",{value:function(){return new this.constructor(this.attributes)}}),Object.defineProperty(i,"isNew",{value:function(){return!this.has(this.idAttribute)}}),Object.defineProperty(i,"isValid",{value:function(a){return this._validate({},g.extend(a||{},{validate:!0}))}}),Object.defineProperty(i,"parse",{value:function(a){return a}}),Object.defineProperty(i,"save",{value:function(b){b=g.extend({validate:!0},b);var c=this,d=c.isNew()?"create":"update";return a(function(a,f){return c.url()?c._validate({},b)?(b.success=function(b){return c.set(c.parse(b))?(c.trigger("sync",c),void a(c)):f(b)},e(c,f,b),void c.sync(d,c,b)):f(c.validationError):f()})}}),Object.defineProperty(i,"fetch",{value:function(b){var c=this;return b=g.extend({},b),a(function(a,d){b.success=function(b){return c.set(c.parse(b))?(c.trigger("fetched",c,b),void a(c)):d(b)},e(c,d,b),c.sync("read",c,b)})}}),Object.defineProperty(i,"destroy",{value:function j(b){b=g.extend({},b);var c=this,j=function(){c.trigger("destroy",c,c.collection,b)};return a(function(a,d){return b.success=function(d){c.isNew()||c.trigger("sync",c,d,b),j(),a(c)},c.isNew()?b.success():(e(c,d,b),void c.sync("delete",c,b))})}}),Object.defineProperty(i,"remove",{value:function(a){this.collection&&this.collection.remove(this,a)}}),Object.defineProperty(i,"setQueryParam",{value:function(a,b){null!=b?this.defaultQueryParams[a]=b:delete this.defaultQueryParams[a]}}),Object.defineProperty(i,"getQueryParams",{value:function(a){var b={};return a=a||{},g.each(this.defaultQueryParams,function(a,c){g.startsWith(a,"@")?b[c]=this.get(g.trimLeft(a,"@")):g.startsWith(a,"=")?b[c]=g.result(this,g.trimLeft(a,"="),null):b[c]=a},this),g.extend({},b,a)}}),Object.defineProperty(i,"_validate",{value:function(a,b){if(!b.validate||!this.validate)return!0;a=g.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c instanceof f?(this.trigger("invalid",this,c,g.extend(b,{validationError:c})),!1):!0}}),h.extend=c,h}]),b.module("angular.models.config",[]).constant("MODELS_CONFIG",function(){var a={};return a.getUrl=function(a){return this.ENDPOINT_PREFIX+this[a]},a}()),b.module("angular.models").service("BaseEventClass",["Extend","_",function(a,b){var c=function(){},d=/\s+/,e=function(a,b,c,d){if(c){var e=a[b]||(a[b]=[]),f=d.context,g=d.ctx,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:f||g,listening:h})}return a},f=function(a,c,e,f,g){var h,i=0;if(e&&"object"==typeof e){void 0!==f&&"context"in g&&void 0===g.context&&(g.context=f);for(h=b.keys(e);i<h.length;i++)c=a(c,h[i],e[h[i]],g)}else if(e&&d.test(e))for(h=e.split(d);i<h.length;i++)c=a(c,h[i],f,g);else c=a(c,e,f,g);return c},g=function(a,b,c,d,g){if(a._events=f(e,a._events||{},b,c,{context:d,ctx:a,listening:g}),g){var h=a._listeners||(a._listeners={});h[g.id]=g}return a},h=function(a,c,d,e){if(!a)return null;var f,g=0,h=e.context,i=e.listeners;if(!c&&!d&&!h){for(var j=b.keys(i);g<j.length;g++)f=i[j[g]],delete i[f.id],delete f.listeningTo[f.objId];return null}for(var k=c?[c]:b.keys(a);g<k.length;g++){c=k[g];var l=a[c];if(!l)break;for(var m=[],n=0;n<l.length;n++){var o=l[n];d&&d!==o.callback&&d!==o.callback._callback||h&&h!==o.context?m.push(o):(f=o.listening,f&&0===--f.count&&(delete i[f.id],delete f.listeningTo[f.objId]))}m.length?a[c]=m:delete a[c]}return b.size(a)?a:void 0},i=function(a,c,d,e){if(d){var f=a[c]=b.once(function(){e(c,f),d.apply(this,arguments)});f._callback=d}return a},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},k=function(a,b,c,d){if(a){var e=a[b],f=a.all;e&&f&&(f=f.slice()),e&&j(e,d),f&&j(f,[b].concat(d))}return a};return c.prototype.on=function(a,b,c){return g(this,a,b,c)},c.prototype.listenTo=function(a,c,d){if(!a)return this;var e=a._listenId||(a._listenId=b.uniqueId("l")),f=this._listeningTo||(this._listeningTo={}),h=f[e];if(!h){var i=this._listenId||(this._listenId=b.uniqueId("l"));h=f[e]={obj:a,objId:e,id:i,listeningTo:f,count:0}}return g(a,c,d,this,h),this},c.prototype.off=function(a,b,c){return this._events?(this._events=f(h,this._events,a,b,{context:c,listeners:this._listeners}),this):this},c.prototype.stopListening=function(a,c,d){var e=this._listeningTo;if(!e)return this;for(var f=a?[a._listenId]:b.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(c,d,this)}return b.isEmpty(e)&&(this._listeningTo=void 0),this},c.prototype.once=function(a,c,d){var e=f(i,{},a,c,b.bind(this.off,this));return this.on(e,void 0,d)},c.prototype.listenToOnce=function(a,c,d){var e=f(i,{},c,d,b.bind(this.stopListening,this,a));return this.listenTo(a,e)},c.prototype.trigger=function(a){if(!this._events)return this;for(var b=Math.max(0,arguments.length-1),c=Array(b),d=0;b>d;d++)c[d]=arguments[d+1];return f(k,this._events,a,void 0,c),this},c.prototype.bind=c.prototype.on,c.prototype.unbind=c.prototype.off,c.extend=a,c}]),b.module("angular.models").factory("BaseExceptionClass",["Extend",function(a){function b(a){this.name="Exception",this.message=a}return b.extend=a,b}]).factory("ValidationExceptionClass",["BaseExceptionClass",function(a){return a.extend({})}]),b.module("angular.models").factory("Extend",["_",function(a){function b(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function c(c){return a.isObject(c)&&(b(c,"value")||b(c,"get")||b(c,"set"))}function d(a,b){function c(){return f||(f=a[b]={}),f}function d(a){return function(b){c()[a]=null==b?!0:b}}var e,f;return e={getter:function(){return c().get=function(){return this.get(b)},e},setter:function(){return c().set=function(a){this.set(b,a)},e},value:function(a){return c().value=a,e},writable:d("writable"),enumerable:d("enumerable"),configurable:d("configurable")}}function e(e,f){var g,h,i=this,j={};return g=e&&b(e,"constructor")?c(e.constructor)?e.constructor.value:e.constructor:function(){return i.apply(this,arguments)},j={},h=a.extend({},e.$declare),delete e.$declare,a.each(h,function(a,b){if("string"==typeof a){var c=-1!==a.indexOf("get;"),e=-1!==a.indexOf("set;"),f=d(j,b);c&&f.getter(),e&&f.setter()}}),a.each(e,function(a,b){j[b]=c(a)?a:{value:a}}),g.prototype=Object.create(i.prototype,j),g.__super__=i.prototype,a.isEmpty(f)||a.each(f,function(a,b){Object.defineProperty(g,b,{value:a})}),g}return e}]),b.module("angular.models").factory("isModel",["BaseModelClass",function(a){return function(b){return b instanceof a}}]).factory("WrapError",["_",function(a){function b(b,c,d){d.error=function(){var d=[].concat([b],a.toArray(arguments));b&&b.trigger.apply(b,[].concat(["error"],d));var e=a.zipObject(["model","xhr","textStatus","error"],d);c&&c(e)}}return b}]),b.module("angular.models").factory("_",["$window",function(a){var b=a._;return b}]),b.module("angular.models").provider("BaseSyncClass",function(){var a={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};this.setOperation=function(b,c){a.hasOwnProperty(b)&&(a[b]=c)},this.$get=["$http","_","Extend","BaseEventClass",function(c,d,e,f){return f.extend({sync:function(e,f,g){var h={};e=a[e],d.defaults(g||(g={})),g.method=g.method||e;var i=d.pick(g,["method","cache","timeout","params","withCredentials","xsrfHeaderName","xsrfCookieName"]);if(i.headers={},i.headers.accept="application/json, text/plain, */*",i.url=g.url||d.result(f,"url"),!i.url)throw new Error('A "url" property or function must be specified');return f&&f.getQueryParams&&(h=f.getQueryParams()),i.params=d.extend({},h,i.params),null==g.data&&f&&d.include(["POST","PUT","PATCH"],e)&&(i.headers["content-type"]="application/json",i.data=JSON.stringify(g.attrs||f.toJSON(g))),i.hasOwnProperty("cache")||(i.cache=this.change),i.transformResponse=this.transformResponse,i.transformRequest=this.transformRequest,g.success=g.success||b.noop,g.error=g.error||b.noop,c(i).success(g.success).error(g.error)},cache:!1,transformResponse:function(a){return a},transformRequest:function(a){return a}},{extend:e})}]})}(window,window.angular)}(angular);
//# sourceMappingURL=angular.models.map