!function(a){!function(a,b,c){"use strict";b.module("angular.models",[]),b.module("angular.models").factory("BaseClass",["Extend",function(a){function b(){}return b.extend=a,b.typeOf=function(a){return a instanceof this},b.prototype.typeOf=function(a){return this instanceof a},b}]),b.module("angular.models").factory("BaseCollectionClass",["$q","BaseSyncClass","BaseModelClass","WrapError","_",function(a,b,c,d,e){var f,g={add:!0,remove:!0,merge:!0},h={add:!0,remove:!1};f=b.extend({constructor:function(a,b){b=b||{},b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this.$reset(),this.initialize.apply(this,arguments),a&&this.reset(a,e.extend({silent:!0},b))},model:{value:null,writable:!0},initialize:{value:e.noop,writable:!0},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){return this.$set(a,e.extend({merge:!1},b,h))},remove:function(a,b){var c=!e.isArray(a);a=c?[a]:e.clone(a),b=b||{};for(var d=0,f=a.length;f>d;d++){var g=a[d]=this.get(a[d]);if(g){var h=this.modelId(g.attributes);null!=h&&delete this._byId[h],delete this._byId[g.cid];var i=this.indexOf(g);this.models.splice(i,1),this.length--,b.silent||(b.index=i,g.trigger("remove",g,this,b)),this.$removeReference(g,b)}}return c?a[0]:a},$set:function(a,b){b=e.defaults({},b,g),b.parse&&(a=e.isString(this.parse)?e.result(a,this.parse):this.parse(a,b));var d=!e.isArray(a);a=d?a?[a]:[]:a.slice();var f,h,i,j,k,l=b.at;0>l&&(l+=this.length+1);var m,n,o=this.comparator&&null==l&&b.sort!==!1,p=e.isString(this.comparator)?this.comparator:null,q=[],r=[],s={},t=b.add,u=b.merge,v=b.remove,w=!o&&t&&v?[]:!1,x=!1;for(m=0,n=a.length;n>m;m++){if(i=a[m],j=this.get(i))v&&(s[j.cid]=!0),u&&i!==j&&(i=c.typeOf(i)?i.attributes:i,b.parse&&(i=j.parse(i,b)),j.$set(i,b),o&&!k&&j.hasChanged(p)&&(k=!0)),a[m]=j;else if(t){if(h=a[m]=this.$prepareModel(i,b),!h)continue;q.push(h),this.$addReference(h,b)}h=j||h,h&&(f=this.modelId(h.attributes),!w||!h.isNew()&&s[f]||(w.push(h),x=x||!this.models[m]||h.cid!==this.models[m].cid),s[f]=!0)}if(v){for(m=0,n=this.length;n>m;m++)s[(h=this.models[m]).cid]||r.push(h);r.length&&this.remove(r,b)}if(q.length||x)if(o&&(k=!0),this.length+=q.length,null!=l)for(m=0,n=q.length;n>m;m++)this.models.splice(l+m,0,q[m]);else{w&&(this.models.length=0);var y=w||q;for(m=0,n=y.length;n>m;m++)this.models.push(y[m])}if(k&&this.sort({silent:!0}),!b.silent){var z=null!=l?e.clone(b):b;for(m=0,n=q.length;n>m;m++)null!=l&&(z.index=l+m),(h=q[m]).trigger("add",h,this,z);(k||x)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b=b?e.clone(b):{};for(var c=0,d=this.models.length;d>c;c++)this.$removeReference(this.models[c],b);return b.previousModels=this.models,this.$reset(),a=this.add(a,e.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},get:function(a){if(null==a)return void 0;var b=this.modelId(c.typeOf(a)?a.attributes:a);return this._byId[a]||this._byId[b]||this._byId[a.cid]},at:function(a){return 0>a&&(a+=this.length),this.models[a]},where:function(a,b){var c=e.matches(a);return this[b?"find":"filter"](function(a){return c(a.attributes)})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),e.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(e.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return e.invoke(this.models,"get",a)},parse:function(a){return a},toArray:function(){return e.invoke(this.models,"toJSON")},fetch:function(b){var c=this;return a(function(a,f){b=e.extend({},b,{parse:!0}),b.success=function(d){c.$set(d,b),c.trigger("fetched",c),a(c)},d(c,f,b),c.sync("read",c,b)})},create:function(b,c){var d=this;return c=c?e.clone(c):{},a(function(a,e){return(b=d.$prepareModel(b,c))?void b.save(c).then(function(){d.add(b,c),b.trigger("created",b,d,c),a(b)},e):e()})},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},$reset:function(){this.length=0,this.models=[],this._byId={}},$prepareModel:function(a,b){if(c.typeOf(a))return a.collection||(a.collection=this),a;b=b?e.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},$addReference:function(a){this._byId[a.cid]=a;var b=this.modelId(a.attributes);null!=b&&(this._byId[b]=a),a.on("all",this.$onModelEvent,this)},$removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this.$onModelEvent,this)},$onModelEvent:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this){if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}this.trigger.apply(this,arguments)}}});var i=["each","map","find","filter","invoke","reject","every","all","some","any","contains","size","first","last","isEmpty","indexOf","indexBy"];return e.each(i,function(a){e[a]&&Object.defineProperty(f.prototype,a,{value:function(){var b=[].slice.call(arguments);return b.unshift(this.models),e[a].apply(e,b)}})}),f}]),b.module("angular.models").service("BaseEventClass",["BaseClass","_",function(a,b){var c,d=/\s+/,e=function(a,b,c,d){if(c){var e=a[b]||(a[b]=[]),f=d.context,g=d.ctx,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:f||g,listening:h})}return a},f=function(a,c,e,f,g){var h,i=0;if(e&&"object"==typeof e){void 0!==f&&"context"in g&&void 0===g.context&&(g.context=f);for(h=b.keys(e);i<h.length;i++)c=a(c,h[i],e[h[i]],g)}else if(e&&d.test(e))for(h=e.split(d);i<h.length;i++)c=a(c,h[i],f,g);else c=a(c,e,f,g);return c},g=function(a,b,c,d,g){if(a._events=f(e,a._events||{},b,c,{context:d,ctx:a,listening:g}),g){var h=a._listeners||(a._listeners={});h[g.id]=g}return a},h=function(a,c,d,e){if(!a)return null;var f,g=0,h=e.context,i=e.listeners;if(!c&&!d&&!h){for(var j=b.keys(i);g<j.length;g++)f=i[j[g]],delete i[f.id],delete f.listeningTo[f.objId];return null}for(var k=c?[c]:b.keys(a);g<k.length;g++){c=k[g];var l=a[c];if(!l)break;for(var m=[],n=0;n<l.length;n++){var o=l[n];d&&d!==o.callback&&d!==o.callback._callback||h&&h!==o.context?m.push(o):(f=o.listening,f&&0===--f.count&&(delete i[f.id],delete f.listeningTo[f.objId]))}m.length?a[c]=m:delete a[c]}return b.size(a)?a:void 0},i=function(a,c,d,e){if(d){var f=a[c]=b.once(function(){e(c,f),d.apply(this,arguments)});f._callback=d}return a},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},k=function(a,b,c,d){if(a){var e=a[b],f=a.all;e&&f&&(f=f.slice()),e&&j(e,d),f&&j(f,[b].concat(d))}return a};return c=a.extend({on:function(a,b,c){return g(this,a,b,c)},listenTo:function(a,c,d){if(!a)return this;var e=a._listenId||(a._listenId=b.uniqueId("l")),f=this._listeningTo||(this._listeningTo={}),h=f[e];if(!h){var i=this._listenId||(this._listenId=b.uniqueId("l"));h=f[e]={obj:a,objId:e,id:i,listeningTo:f,count:0}}return g(a,c,d,this,h),this},off:function(a,b,c){return this._events?(this._events=f(h,this._events,a,b,{context:c,listeners:this._listeners}),this):this},stopListening:function(a,c,d){var e=this._listeningTo;if(!e)return this;for(var f=a?[a._listenId]:b.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(c,d,this)}return b.isEmpty(e)&&(this._listeningTo=void 0),this},once:function(a,c,d){var e=f(i,{},a,c,b.bind(this.off,this));return this.on(e,void 0,d)},listenToOnce:function(a,c,d){var e=f(i,{},c,d,b.bind(this.stopListening,this,a));return this.listenTo(a,e)},trigger:function(a){if(!this._events)return this;for(var b=Math.max(0,arguments.length-1),c=Array(b),d=0;b>d;d++)c[d]=arguments[d+1];return f(k,this._events,a,void 0,c),this}})}]),b.module("angular.models").factory("BaseModelClass",["$q","$parse","BaseSyncClass","WrapError","ValidationExceptionClass","_",function(a,b,c,d,e,f){var g;return g=c.extend({constructor:function(a,b){var c=a||{};b=b||{},this.cid=f.uniqueId("c"),this.attributes={},b.parse&&(c=f.isString(this.parse)?f.result(c,this.parse,{}):this.parse(c,b)||{}),b.collection&&(this.collection=b.collection),c=f.defaults({},c,f.result(this,"defaults")),this.$set(c,b),this.changed={},this.initialize.apply(this,arguments)},defaultQueryParams:{value:{},writable:!0},changed:{value:null,writable:!0},validationError:{value:null,writable:!0},idAttribute:{value:"id",writable:!0},initialize:{value:f.noop,writable:!0},serializeModel:{value:[],writable:!0},toJSON:function(){var a=this,b=f.cloneDeep(this.attributes);return f.isArray(this.serializeModel)&&this.serializeModel.length&&f.each(this.serializeModel,function(c){b[c]="toJSON"in a[c]?a[c].toJSON():null}),b},$get:function(a){var c=b(a);return c(this.attributes)},is:function(a){return!!this.attributes[a]},has:function(a){return null!=this.$get(a)},$set:function(a,b,c){var d,g,h,i,j,k,l,m;if(null==a)return this;"object"==typeof a?(g=a,c=b):(g={})[a]=b,c=c||{},c.validate=!0;var n=this.$validate(g,c);if(n instanceof e)return!1;h=c.unset,j=c.silent,i=[],k=this._changing,this._changing=!0,k||(this._previousAttributes=f.clone(this.attributes),this.changed={}),m=this.attributes,l=this._previousAttributes,this.idAttribute in g&&(this.id=g[this.idAttribute]);for(d in g)b=g[d],f.isEqual(m[d],b)||i.push(d),f.isEqual(l[d],b)?delete this.changed[d]:this.changed[d]=b,h===!0?delete m[d]:m[d]=b;if(!j){i.length&&(this._pending=c);for(var o=0,p=i.length;p>o;o++)this.trigger("change:"+i[o],this,m[i[o]],c)}if(k)return this;if(!j)for(;this._pending;)c=this._pending,this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.$set(a,void 0,f.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.$set(b,f.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)f.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return f.clone(this._previousAttributes)},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url");if(null==a)throw new Error('A "url" property or function must be specified');return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this.$validate({},f.extend(a||{},{validate:!0}))},parse:function(a){return a},save:function(b){b=f.extend({validate:!0},b);var c=this,e=c.isNew()?"create":"update";return a(function(a,f){return c.url()?c.$validate({},b)?(b.success=function(b){return c.$set(c.parse(b))?(c.trigger("sync",c),void a(c)):f(b)},d(c,f,b),void c.sync(e,c,b)):f(c.validationError):f()})},fetch:function(b){var c=this;return b=f.extend({},b),a(function(a,e){b.success=function(b){return c.$set(c.parse(b))?(c.trigger("fetched",c,b),void a(c)):e(b)},d(c,e,b),c.sync("read",c,b)})},destroy:function h(b){b=f.extend({},b);var c=this,h=function(){c.trigger("destroy",c,c.collection,b)};return a(function(a,e){return b.success=function(d){c.isNew()||c.trigger("sync",c,d,b),h(),a(c)},c.isNew()?b.success():(d(c,e,b),void c.sync("delete",c,b))})},remove:function(a){this.collection&&this.collection.remove(this,a)},setQueryParam:function(a,b){null!=b?this.defaultQueryParams[a]=b:delete this.defaultQueryParams[a]},getQueryParams:function(a){var b={};return a=a||{},f.each(this.defaultQueryParams,function(a,c){f.startsWith(a,"@")?b[c]=this.$get(f.trimLeft(a,"@")):f.startsWith(a,"=")?b[c]=f.result(this,f.trimLeft(a,"="),null):b[c]=a},this),f.extend({},b,a)},$validate:function(a,b){if(!b.validate||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c instanceof e?(this.trigger("invalid",this,c,f.extend(b,{validationError:c})),!1):!0}})}]),b.module("angular.models").provider("BaseSyncClass",function(){var a={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};this.setOperation=function(b,c){a.hasOwnProperty(b)&&(a[b]=c)},this.$get=["$http","_","Extend","BaseEventClass",function(c,d,e,f){return f.extend({sync:function(e,f,g){var h={};e=a[e],d.defaults(g||(g={})),g.method=g.method||e;var i=d.pick(g,["method","cache","timeout","params","withCredentials","xsrfHeaderName","xsrfCookieName"]);if(i.headers=g.headers||{},i.headers.accept||(i.headers.accept="application/json, text/plain, */*"),i.url=g.url||d.result(f,"url"),!i.url)throw new Error('A "url" property or function must be specified');return f&&f.getQueryParams&&(h=f.getQueryParams()),i.params=d.extend({},h,i.params),null==g.data&&f&&d.include(["POST","PUT","PATCH"],e)&&(i.headers["content-type"]="application/json",i.data=JSON.stringify(g.attrs||f.toJSON(g))),i.hasOwnProperty("cache")||(i.cache=this.change),i.transformResponse=this.$transformResponse,i.transformRequest=this.$transformRequest,g.success=g.success||b.noop,g.error=g.error||b.noop,c(i).success(g.success).error(g.error)},cache:{value:!1,writable:!0},$transformResponse:function(a){return a},$transformRequest:function(a){return a}},{extend:e})}]}),b.module("angular.models.config",[]).constant("MODELS_CONFIG",function(){var a={};return a.getUrl=function(a){return this.ENDPOINT_PREFIX+this[a]},a}()),b.module("angular.models").factory("BaseExceptionClass",["Extend",function(a){function b(a){this.name="Exception",this.message=a}return b.extend=a,b}]).factory("ValidationExceptionClass",["BaseExceptionClass",function(a){return a.extend({})}]),b.module("angular.models").factory("Extend",["_",function(a){function b(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function c(c){return a.isObject(c)&&(b(c,"value")||b(c,"get")||b(c,"set"))}function d(a,b){a.get=function(){return this.$get(b)}}function e(a,b){a.set=function(a){this.$set(b,a)}}function f(g,h){var i,j,k=this,l={};return g&&b(g,"constructor")?i="object"==typeof g.constructor?g.constructor.value:g.constructor:(i=function(){return k.apply(this,arguments)},g.constructor=i),j=a.extend({},g.$$properties),delete g.$$properties,a.each(j,function(a,b){if("string"==typeof a){var c=-1!==a.indexOf("get;"),f=-1!==a.indexOf("set;");l[b]={},c&&d(l[b],b),f&&e(l[b],b)}}),a.each(g,function(a,b){var d=a;c(d)||(d={value:d}),"function"==typeof d.value&&(d.writable=!0),l[b]=d}),i.prototype=Object.create(k.prototype,l),i.__super__=k.prototype,i.typeOf=function(a){return a instanceof k},i.extend=f,a.isEmpty(h)||a.each(h,function(a,b){Object.defineProperty(i,b,{value:a})}),i}return f}]),b.module("angular.models").factory("isModel",["BaseModelClass",function(a){return function(b){return b instanceof a}}]).factory("WrapError",["_",function(a){function b(b,c,d){d.error=function(){var d=[].concat([b],a.toArray(arguments));b&&b.trigger.apply(b,[].concat(["error"],d));var e=a.zipObject(["model","xhr","textStatus","error"],d);c&&c(e)}}return b}]),b.module("angular.models").factory("_",function(){return a._})}(window,window.angular)}(angular);
//# sourceMappingURL=angular.models.map